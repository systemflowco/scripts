(()=>{class s{constructor(s){this.slug=window.easyLmsInfo.lessonSlug,this.courseName=window.easyLmsInfo.courseName,this.lessonName=window.easyLmsInfo.lessonName,this.productId=window.easyLmsInfo.ecProductId,this.userId=window._EC_USER_ID,this.webhookUrlField=document.querySelector("[data-easylms-webhook-url]"),this.webhookUrl=webhookUrlField?webhookUrlField.value:"",this.finishBtn=document.querySelector("[data-lms-finish-btn]"),this.finishedBtn=document.querySelector("[data-lms-finished-btn]"),this.nextLessonBtn=document.querySelector("[data-lms-next-btn]"),this.autoplayBtn=document.querySelector("[data-lms-autoplay-btn] input"),this.lessons=document.querySelectorAll(".course-content-lesson"),this.KEY_FINISH="LESSON.FINISH",this.KEY_LAST="LESSON.LAST",this.KEY_AUTOPLAY="LESSON.AUTOPLAY",this.autoplayMode=!1,this.finishedLessons=[],this.lastLesson="",this.assignEvents()}assignEvents(){this.saveLastLesson(),"undefined"==typeof easy_json?this.checking():window.easyJSON?this.checking():$(document).on("easyJsonReady",this.checking.bind(this)),this.finishBtn.addEventListener("click",this.toggleFinishStatus.bind(this)),$(document).on("finishLesson",this.finishLesson.bind(this)),$(document).on("nextLesson",this.goToNextLesson.bind(this)),$(document).on("videoProgress",(s,e)=>{this.updateLastLessonProgress(e)}),$(document).on("playerReady",this.checkLastLesson.bind(this))}checking(){this.checkIfAutoplay(),this.checkIfFinished(),this.checkAllLessons()}checkLastLesson(){this.lastLesson=this.readLsAndEj(this.KEY_LAST),this.lastLesson&&this.lastLesson.lessonSlug==this.slug&&this.lastLesson.progress&&$(document).trigger("goToVideoSecond",this.lastLesson.progress)}saveLastLesson(){this.saveLsAndEj(this.KEY_LAST,{lesson:this.lessonName,lessonSlug:this.slug,course:this.courseName}),this.sendWebhook({type:"lastLesson",location:window.location.href,ecUserId:this.userId,ecProductId:this.productId,lessonName:this.lessonName,lessonSlug:this.lessonSlug,courseName:this.courseName})}updateLastLessonProgress(s){this.saveLsAndEj(this.KEY_LAST,{lesson:this.lessonName,lessonSlug:this.slug,course:this.courseName,progress:Math.round(s)})}checkIfAutoplay(){this.autoplayMode=this.readLsAndEj(this.KEY_AUTOPLAY)||!1,setTimeout(()=>{this.autoplayMode&&this.autoplayBtn.click(),this.autoplayBtn.addEventListener("click",this.toggleAutoplayMode.bind(this))},500)}toggleAutoplayMode(){this.autoplayMode=!this.autoplayMode,this.saveLsAndEj(this.KEY_AUTOPLAY,this.autoplayMode)}goToNextLesson(){this.nextLessonBtn.click()}checkIfFinished(){this.finishedLessons=this.readLsAndEj(this.KEY_FINISH)||[],this.finishedLessons.indexOf(this.slug)>-1&&this.toggleFinishStatus()}checkAllLessons(){let s=0;this.lessons.forEach(e=>{e.slug=e.href.match(/(?<=lekcje\/).+/)[0],this.finishedLessons.indexOf(e.slug)>-1&&(e.querySelector(".not-done").style.display="none",e.querySelector(".is-done").style.display="block",s++)});const e=Math.round(s/this.lessons.length*100);document.querySelector(".course-progress-circle-text").innerText=`${e}%`;const t=document.querySelector(".progress-ring__circle");if(t&&t.r){const s=t.r.baseVal.value,o=2*s*Math.PI;t.style.strokeDasharray=`${o} ${o}`,t.style.strokeDashoffset=o;const n=o-e/100*o;t.style.strokeDashoffset=n}}toggleFinishStatus(){this.finishBtn.style.display="none",this.finishedBtn.style.display="flex",-1==this.finishedLessons.indexOf(this.slug)&&this.finishedLessons.push(this.slug),this.checkAllLessons(),this.sendWebhook({type:"lessonFinished",location:window.location.href,ecUserId:this.userId,ecProductId:this.productId,lessonName:this.lessonName,lessonSlug:this.lessonSlug,courseName:this.courseName}),this.saveLsAndEj(this.KEY_FINISH,this.finishedLessons)}finishLesson(){this.toggleFinishStatus(),this.autoplayMode&&setTimeout(()=>{$(document).trigger("nextLesson")},1e3)}saveLsAndEj(s,e){const t={};t[s]=JSON.stringify(e),localStorage.setItem(s,t[s]),"undefined"!=typeof easy_json&&easy_json.patch(t)}readLsAndEj(s){if(window.easyJSON&&window.easyJSON[s]){let e=window.easyJSON[s];return localStorage.setItem(s,e),JSON.parse(e)}return JSON.parse(localStorage.getItem(s))}sendWebhook(s){if(this.webhookUrl){const e=new XMLHttpRequest;e.open("POST",this.webhookUrl,!0),e.setRequestHeader("Content-type","application/json"),e.send(JSON.stringify(s))}}}document.addEventListener("DOMContentLoaded",function(e){new s})})();