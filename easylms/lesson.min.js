(()=>{class s{constructor(s){this.slug=window.easyLmsInfo.lessonSlug,this.courseName=window.easyLmsInfo.courseName,this.lessonName=window.easyLmsInfo.lessonName,this.productId=window.easyLmsInfo.ecProductId,this.userId=window._EC_USER_ID,this.lessonVideo=window.easyLmsInfo.lessonVideo,this.webhookUrlField=document.querySelector("[data-easylms-webhook-url]"),this.webhookUrl=this.webhookUrlField?this.webhookUrlField.innerText:"",this.finishBtn=document.querySelector("[data-lms-finish-btn]"),this.finishedBtn=document.querySelector("[data-lms-finished-btn]"),this.nextLessonBtn=document.querySelector("[data-lms-next-btn]"),this.autoplayBtn=document.querySelector("[data-lms-autoplay-btn] input"),this.lessons=document.querySelectorAll(".course-content-lesson"),this.KEY_FINISH="LESSON.FINISH",this.KEY_LAST="LESSON.LAST",this.KEY_AUTOPLAY="LESSON.AUTOPLAY",this.KEY_PLAYRATE="PLAYBACK.RATE",this.autoplayMode=!1,this.finishedLessons=[],this.lastLesson="",this.playbackRate=1,this.assignEvents()}assignEvents(){this.showAutoPlayInfo(),this.saveLastLesson(),"undefined"==typeof easy_json?this.checking():window.easyJSON?this.checking():$(document).on("easyJsonReady",this.checking.bind(this)),this.finishBtn.addEventListener("click",this.toggleFinishStatus.bind(this)),this.finishedBtn.addEventListener("click",this.revertFinishStatus.bind(this)),$(document).on("finishLesson",this.finishLesson.bind(this)),$(document).on("nextLesson",this.goToNextLesson.bind(this)),$(document).on("videoProgress",(s,e)=>{this.updateLastLessonProgress(e)}),$(document).on("playerReady",this.checkLastLesson.bind(this)),$(document).on("playerPlay",this.checkPlaybackRate.bind(this)),$(document).on("playbackRate",(s,e)=>{this.savePlaybackRate(e)})}checking(){this.checkIfAutoplay(),this.checkIfFinished(),this.checkAllLessons()}checkPlaybackRate(){this.playbackRate=this.readLsAndEj(this.KEY_PLAYRATE),this.playbackRate&&$(document).trigger("setPlaybackRate",this.playbackRate)}checkLastLesson(){this.lastLesson=this.readLsAndEj(this.KEY_LAST),this.lastLesson&&this.lastLesson.lessonSlug==this.slug&&this.lastLesson.progress&&$(document).trigger("goToVideoSecond",this.lastLesson.progress)}savePlaybackRate(s){this.playbackRate=s,this.saveLsAndEj(this.KEY_PLAYRATE,this.playbackRate)}saveLastLesson(){this.saveLsAndEj(this.KEY_LAST,{lesson:this.lessonName,lessonSlug:this.slug,course:this.courseName}),this.sendWebhook({type:"lastLesson",location:window.location.href,ecUserId:this.userId,ecProductId:this.productId,lessonName:this.lessonName,lessonSlug:this.slug,courseName:this.courseName})}updateLastLessonProgress(s){this.saveLsAndEj(this.KEY_LAST,{lesson:this.lessonName,lessonSlug:this.slug,course:this.courseName,progress:Math.round(s)})}checkIfAutoplay(){this.autoplayMode=this.readLsAndEj(this.KEY_AUTOPLAY)||!1,setTimeout(()=>{this.autoplayMode&&this.autoplayBtn.click(),this.autoplayBtn.addEventListener("click",this.toggleAutoplayMode.bind(this))},500)}toggleAutoplayMode(){this.autoplayMode=!this.autoplayMode,this.saveLsAndEj(this.KEY_AUTOPLAY,this.autoplayMode)}goToNextLesson(){this.nextLessonBtn.click()}checkIfFinished(){this.finishedLessons=this.readLsAndEj(this.KEY_FINISH)||[],this.finishedLessons.indexOf(this.slug)>-1&&this.toggleFinishStatus()}checkAllLessons(){let s=0;this.lessons.forEach(e=>{let t=e.href.match(/lekcje\/(.+)/);e.slug=t?t[1]:"",e.slug&&(this.finishedLessons.indexOf(e.slug)>-1?(e.querySelector(".not-done").style.display="none",e.querySelector(".is-done").style.display="block",s++):(e.querySelector(".not-done").style.display="block",e.querySelector(".is-done").style.display="none"))});const e=Math.round(s/this.lessons.length*100);document.querySelector(".course-progress-circle-text").innerText=`${e}%`;const t=document.querySelector(".progress-ring__circle");if(t&&t.r){const s=t.r.baseVal.value,o=2*s*Math.PI;t.style.strokeDasharray=`${o} ${o}`,t.style.strokeDashoffset=o;const i=o-e/100*o;t.style.strokeDashoffset=i}}toggleFinishStatus(){this.finishBtn.style.display="none",this.finishedBtn.style.display="flex",-1==this.finishedLessons.indexOf(this.slug)&&this.finishedLessons.push(this.slug),this.checkAllLessons(),this.sendWebhook({type:"lessonFinished",location:window.location.href,ecUserId:this.userId,ecProductId:this.productId,lessonName:this.lessonName,lessonSlug:this.lessonSlug,courseName:this.courseName}),this.saveLsAndEj(this.KEY_FINISH,this.finishedLessons)}revertFinishStatus(){this.finishedBtn.style.display="none",this.finishBtn.style.display="flex";let s=this.finishedLessons.indexOf(this.slug);-1!=s&&this.finishedLessons.splice(s,1),this.checkAllLessons(),this.saveLsAndEj(this.KEY_FINISH,this.finishedLessons)}finishLesson(){this.toggleFinishStatus(),this.autoplayMode&&setTimeout(()=>{$(document).trigger("nextLesson")},1e3)}saveLsAndEj(s,e){const t={};t[s]=JSON.stringify(e),localStorage.setItem(s,t[s]),"undefined"!=typeof easy_json&&easy_json.patch(t)}readLsAndEj(s){if(window.easyJSON&&window.easyJSON[s]){let e=window.easyJSON[s];return localStorage.setItem(s,e),JSON.parse(e)}return JSON.parse(localStorage.getItem(s))}sendWebhook(s){if(this.webhookUrl&&this.userId&&!this.webhookUrl.includes("Zamień ten tekst")){const e=new XMLHttpRequest;e.open("POST",this.webhookUrl,!0),e.setRequestHeader("Content-type","application/json"),e.send(JSON.stringify(s))}}showAutoPlayInfo(){const s=document.createElement("div");s.innerHTML='<div class="tooltip-trigger" data-ix="tooltip-hover" style="display: inline-block;"><div class="tooltip-trigger-content"><div class="tooltip" style="display: none;"><div class="text-block c-t-neutral-10">Część przeglądarek, np. Safari, blokuje autoodtwarzanie. <br>Jeśli ta opcja nie działa poprawnie w Twojej przeglądarce, <a href="https://www.notion.so/Autoodtwarzanie-8a148c1cbb6c4091b67127554a3b8475">zobacz jak ją odblokować</a></div><div class="tooltip-arrow"></div></div><div class="material-icons">info</div></div></div>',s.style.paddingLeft="4px";const e=s.querySelector(".tooltip");e.style.top="36px",e.style.bottom="auto";const t=s.querySelector(".tooltip-arrow");t.style.top="-6px",t.style.bottom="auto";const o=document.querySelector("[data-lms-autoplay-btn]");o&&(o.append(s),s.addEventListener("mouseenter",()=>{s.querySelector(".tooltip").style.display="block"}),s.addEventListener("mouseleave",()=>{s.querySelector(".tooltip").style.display="none"}))}}document.addEventListener("DOMContentLoaded",function(e){new s})})();